## 排序算法的下界

到目前为止，我们介绍了几种能在 O(n * lgn) 时间内排序 n 个数的算法，归并排序和堆排序达到了最坏情况下的上界，快速排序在平均情况下达到该上界。而且，对于这些算法中的每一个，我们都能给出 n 个输入数值，使得该算法能在 Ω(n * lgn) 时间内完成。

这些算法都有一个有趣的性质：在排序的最终结果中，各元素的次序依赖于它们之间的比较。我们把这类排序算法称为比较排序，到目前为止，我们介绍的所有排序算法都是比较排序。

在一个比较排序算法中，我们只使用元素间的比较来获得输入序列 [a1, a2, ..., an] 中的元素次序的信息。也就是说，给定两个元素 ai 和 aj，可以执行 ai < aj，ai <= aj，ai = aj，ai >= aj 或者 ai > aj 中的一个比较操作来确定它们之间的相对次序，我们不能用其它方法观察元素的值或者它们之间的次序信息。

不失一般性，我们不妨假设所有的输入元素都是互异的，给定了这个假设后， ai = aj 的比较就没有意义了。因此，我们可以假设不需要这种比较。同时，注意到 ai <= aj、ai >= aj、ai > aj 和 ai < aj 都是等价的，因为通过它们所得到的关于 ai 和 aj 的相对次序的信息都是相同的。这样，又可以进一步假设所有比较采用的都是 ai <= aj 形式。

### 决策树模型

比较排序可以被抽象为一棵决策树。决策树是一棵完全二叉树，它可以表示在给定输入规模情况下，某一特定排序算法对所有元素的比较操作。其中，控制、数据移动等其它操作都被忽略了。下图显示了插入排序算法作用于包含三个元素的输入序列的决策树情况。

![](../assets/images/sorting-and-order-statistics/decision-tree.png)

作用于 3 个元素时的插入排序决策树。标记为 i : j 的内部结点表示 ai 和 aj 之间的比较。排列为 [s[1], s[2], ..., s[n]] 的叶结点表示得到的顺序 as[1] <= as[2] <= ... <= as[n]。加了阴影的路径表示在对输入序列 [6, 8, 5] 进行排序时所做的决策，叶结点上的排列 [3, 1, 2] 表示排序的顺序是 a[3] = 5 <= a[1] = 6 <= a[2] = 8.对于输入元素来说，共有 3! = 6 种可能的排列，因此决策树至少包含 6 个叶结点。

在决策树中，每个内部结点都以 i : j 标记，其中，i 和 j 满足 1 <= i，j <= n，n 是输入序列中的元素个数。每个叶结点上都标注一个序列 [s[1], s[2], ..., s[n]]。排序算法的执行对应于一条从数的根结点到叶结点的路径。每一个内部结点表示一次比较 ai <= aj。左子树表示一旦我们确定 ai <= aj 后的后续比较，右子树则表示在确定了 ai > aj 后的后续比较。当到达一个叶结点时，表示排序算法已经确定了一个顺序 as[1] <= as[2] <= .. <= as[n]。因为任何正确的排序算法都能够生成输入的每一个排列，所以对一个正确的比较排序算法来说，n 个元素的 n! 中可能的排列都应该出现在决策树的叶结点上。而且，每一个叶结点都必须是可以从根结点经由某条路径到达的，该路径对应于比较排序的一次实际执行过程（我们称这种叶结点为可达的）。因此，在后续内容中，我们将只考虑每一种排列都是一个可达的叶结点的决策树。

### 最坏情况的下界

在决策树中，从根结点到任意一个可达叶结点之间最长简单路径的长度，表示的是对应的排序算法中最坏情况下的比较次数。因此，一个比较排序算法中的最坏情况比较次数就等于其决策树的高度。同时，当决策树中每种排列都是可达的叶结点的形式出现时，该决策树高度的下界也就是比较排序算法运行时间的下界。下面的定理给出了这样的一个下界。

> 定理：在最坏情况下，任何比较排序算法都需要做 Ω(n * lgn) 次比较

证明：根据前面的讨论，对于一棵每个排列都是一个可达的叶结点的决策树来说，树的高度完全可以被确定。考虑一棵高度为 h、具有 l 个可达叶结点的决策树，它对应一个对 n 个元素所做的比较排序。因为输入数据的 n! 种可能的排列都是叶结点，所以有 n! <= l。由于在一棵高度为 h 的二叉树中，叶结点数目不多于 2^h，我们得到：

```
n! <= l <= 2^h
```

对该式两边取对数，有

```
h >= lg(n!) = Ω(n * lgn)
```

> 推论：堆排序和归并排序都是渐近最优的比较排序算法

证明：堆排序和归并排序的运行时间上界为 O(n * lgn)，这与以上定理给出的最坏情况的下界 Ω(n * lgn) 是一致的。因此，归并排序和堆排序都是渐近最优的，并且任何已知的比较排序最多就是在常数因子上优于它们。
